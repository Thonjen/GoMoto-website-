import{r as T,z as I,c as w,a as J,o as r,w as Y,b as e,e as v,t as s,f as n,i as a,F as M,h as S,d as K,u as d,S as W,l as X,n as B,g as y,D as O,v as P,Q as Z}from"./app-Bp2smfCm.js";import{A as ee}from"./AuthenticatedLayout-CeqprHFF.js";import{S as V}from"./sweetalert2.esm.all-ePrzfkxH.js";import"./Footer-BrurEhWM.js";import"./Header-fek8bTNe.js";const te={class:"min-h-screen py-8"},ie={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},oe={class:"glass-card border border-white/20 rounded-lg shadow-glow backdrop-blur-sm"},se={class:"p-6"},le={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},re={class:"glass-card p-6 rounded-lg mb-6 border border-white/20 backdrop-blur-sm"},ne=["src","alt"],de={class:"text-lg font-semibold text-white"},ae={class:"text-white/80"},ue={class:"mt-4 grid grid-cols-2 gap-4 text-sm text-white/90"},ce={key:0,class:"mb-6 p-4 bg-red-500/20 border border-red-400/30 rounded-lg text-red-300 backdrop-blur-sm"},me={class:"flex"},be={class:"ml-3"},ve={class:"mt-2 text-sm"},he={class:"list-disc list-inside space-y-1"},fe={key:0},ge={key:1},ke={key:2},pe={key:3},xe={key:1,class:"mb-6 p-4 bg-yellow-500/20 border border-yellow-400/30 rounded-lg text-yellow-300 backdrop-blur-sm"},we={class:"flex"},ye={class:"ml-3"},_e={class:"mt-2 text-sm"},Be={class:"list-disc list-inside space-y-1"},Ce={class:"mt-2"},Te=["disabled"],Me={class:"space-y-3"},Se=["onClick"],Pe={class:"flex items-center justify-between"},Ve={class:"flex items-center"},Ae=["id","value"],De={class:"ml-3"},$e=["for"],ze={class:"text-lg font-bold text-green-400"},je={key:0,class:"mt-2 text-sm text-red-400"},Le={class:"grid grid-cols-2 gap-4"},Ne=["min"],Ee={key:0,class:"mt-2 text-sm text-red-400"},Fe=["min"],Ue={key:0,class:"mt-2 text-sm text-red-400"},Ye={class:"space-y-3"},Oe=["onClick"],Re={class:"flex items-center"},qe=["id","value"],Ge={class:"ml-3"},Qe=["for"],He={key:0,class:"text-xs text-white/60"},Ie={key:1,class:"text-xs text-white/60"},Je={key:0,class:"text-center py-8 text-white/60 border border-white/20 rounded-lg backdrop-blur-sm"},Ke={key:0,class:"mt-2 text-sm text-red-400"},We={key:0},Xe={key:0,class:"mt-2 text-sm text-red-400"},Ze={key:1,class:"bg-green-400/20 border border-green-400/30 rounded-lg p-4 backdrop-blur-sm"},et={class:"flex justify-between items-center"},tt={class:"text-2xl font-bold text-green-400"},it=["disabled"],ot={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ut={__name:"Create",props:{vehicle:Object,availablePaymentMethods:Array,errors:Object,userActiveBookings:Array},setup(i){const m=i,g=T(!1),C=new Date().toISOString().split("T")[0],A=new Date().toTimeString().slice(0,5),l=I({pricing_tier_id:null,pickup_date:C,pickup_time:A,payment_mode_id:null,reference_number:""}),_=w(()=>l.pricing_tier_id?m.vehicle.pricing_tiers.find(u=>u.id==l.pricing_tier_id):null),R=w(()=>{if(!l.payment_mode_id)return!1;const u=m.availablePaymentMethods.find(t=>t.id==l.payment_mode_id);return(u==null?void 0:u.type)==="gcash"}),q=w(()=>m.errors&&(m.errors.booking_conflict||m.errors.vehicle_unavailable||m.errors.rate_limit||m.errors.user_booking_conflict)),k=T(A);function G(){const u=C;if(l.pickup_date===u){const t=new Date;k.value=t.toTimeString().slice(0,5),l.pickup_time<k.value&&(l.pickup_time=k.value)}else k.value="00:00"}const p=T(null);function D(u){var t;try{const b=p==null?void 0:p.value;if(!b)return;if(typeof b.showPicker=="function"){b.showPicker();return}b.focus()}catch{try{(t=p.value)==null||t.focus()}catch{}}}const x=w(()=>m.userActiveBookings&&m.userActiveBookings.length>0),$=w(()=>!x.value&&!g.value);function Q(){var u,t;g.value||V.fire({title:"Confirm Booking",text:`You are about to book this vehicle for ${((u=_.value)==null?void 0:u.name)||"selected duration"}. Total: ₱${((t=_.value)==null?void 0:t.price)||0}`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3b82f6",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, Book Now!",cancelButtonText:"Cancel"}).then(b=>{b.isConfirmed&&(g.value=!0,l.post(route("bookings.store",m.vehicle.id),{onSuccess:()=>{V.fire({title:"Booking Successful!",text:"Your booking has been created successfully.",icon:"success",confirmButtonColor:"#3b82f6"})},onError:c=>{g.value=!1,console.log("Booking errors:",c);let h="There was an error processing your booking.";c.booking_conflict?h=c.booking_conflict:c.vehicle_unavailable?h=c.vehicle_unavailable:c.rate_limit?h=c.rate_limit:c.user_booking_conflict&&(h=c.user_booking_conflict),V.fire({title:"Booking Failed",text:h,icon:"error",confirmButtonColor:"#3b82f6"})},onFinish:()=>{g.value=!1}}))})}function H(){window.history.length>1?window.history.back():Z.visit(`/vehicles/${m.vehicle.id}`)}return(u,t)=>(r(),J(ee,null,{default:Y(()=>{var b,c,h,z,j,L,N,E,F;return[e("div",te,[e("div",ie,[e("div",oe,[e("div",se,[e("div",{class:"mb-6"},[e("button",{onClick:H,class:"inline-flex items-center text-white hover:text-white/80 font-semibold transition-colors bg-[#00000040] px-4 py-2 rounded-lg backdrop-blur-sm border border-white/20"},t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),v(" Back to Vehicle ")]))]),t[28]||(t[28]=e("h1",{class:"text-3xl font-bold text-white mb-8"}," Book Vehicle ",-1)),e("div",le,[e("div",null,[e("div",re,[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold mb-4 text-white"}," Vehicle Details ",-1)),e("img",{src:i.vehicle.main_photo_url||"/images/placeholder-vehicle.jpg",alt:`${(b=i.vehicle.make)==null?void 0:b.name} ${((c=i.vehicle.model)==null?void 0:c.name)||((h=i.vehicle.type)==null?void 0:h.sub_type)}`,class:"w-full h-48 object-cover rounded-lg mb-4"},null,8,ne),e("h3",de,s((z=i.vehicle.make)==null?void 0:z.name)+" "+s(((j=i.vehicle.model)==null?void 0:j.name)||((L=i.vehicle.type)==null?void 0:L.sub_type)),1),e("p",ae,s(i.vehicle.description),1),e("div",ue,[e("div",null,[t[6]||(t[6]=e("strong",null,"Year:",-1)),v(" "+s(i.vehicle.year),1)]),e("div",null,[t[7]||(t[7]=e("strong",null,"Color:",-1)),v(" "+s(i.vehicle.color),1)]),e("div",null,[t[8]||(t[8]=e("strong",null,"Fuel:",-1)),v(" "+s(((N=i.vehicle.fuelTypes)==null?void 0:N.name)||((E=i.vehicle.fuel_type)==null?void 0:E.name)),1)]),e("div",null,[t[9]||(t[9]=e("strong",null,"Transmission:",-1)),v(" "+s(((F=i.vehicle.transmission)==null?void 0:F.name)||"Manual"),1)]),e("div",null,[t[10]||(t[10]=e("strong",null,"Location:",-1)),v(" "+s(i.vehicle.location_name),1)])])])]),e("div",null,[q.value?(r(),n("div",ce,[e("div",me,[t[13]||(t[13]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",be,[t[12]||(t[12]=e("h3",{class:"text-sm font-medium text-red-300"}," Booking Error ",-1)),e("div",ve,[e("ul",he,[i.errors.booking_conflict?(r(),n("li",fe,s(i.errors.booking_conflict),1)):a("",!0),i.errors.vehicle_unavailable?(r(),n("li",ge,s(i.errors.vehicle_unavailable),1)):a("",!0),i.errors.rate_limit?(r(),n("li",ke,s(i.errors.rate_limit),1)):a("",!0),i.errors.user_booking_conflict?(r(),n("li",pe,s(i.errors.user_booking_conflict),1)):a("",!0)])])])])])):a("",!0),x.value?(r(),n("div",xe,[e("div",we,[t[19]||(t[19]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),e("div",ye,[t[18]||(t[18]=e("h3",{class:"text-sm font-medium text-yellow-300"}," Active Booking Found ",-1)),e("div",_e,[t[17]||(t[17]=e("p",{class:"mb-2"},"You already have active bookings for this vehicle:",-1)),e("ul",Be,[(r(!0),n(M,null,S(i.userActiveBookings,o=>{var f,U;return r(),n("li",{key:o.id},s(new Date(o.pickup_datetime).toLocaleString())+" ("+s((f=o.pricing_tier)==null?void 0:f.duration_from)+" "+s((U=o.pricing_tier)==null?void 0:U.duration_unit)+") - Status: "+s(o.status),1)}),128))]),e("p",Ce,[t[15]||(t[15]=v(" Please ")),K(d(W),{href:u.route("bookings.index"),class:"text-blue-400 hover:text-blue-300 underline"},{default:Y(()=>t[14]||(t[14]=[v("manage your existing bookings")])),_:1,__:[14]},8,["href"]),t[16]||(t[16]=v(" or wait until they are completed before booking again. "))])])])])])):a("",!0),e("form",{onSubmit:X(Q,["prevent"]),class:"space-y-6"},[e("fieldset",{disabled:x.value,class:B(["space-y-6",{"opacity-60":x.value}])},[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-white mb-3"},"Select Rental Duration",-1)),e("div",Me,[(r(!0),n(M,null,S(i.vehicle.pricing_tiers,o=>(r(),n("div",{key:o.id,class:B(["border rounded-lg p-4 cursor-pointer transition-all backdrop-blur-sm",d(l).pricing_tier_id==o.id?"border-blue-400 bg-blue-400/20":"border-white/20 hover:border-white/30 hover:bg-white/5"]),onClick:f=>d(l).pricing_tier_id=o.id},[e("div",Pe,[e("div",Ve,[y(e("input",{type:"radio",id:`tier-${o.id}`,value:o.id,"onUpdate:modelValue":t[0]||(t[0]=f=>d(l).pricing_tier_id=f),class:"h-4 w-4 text-blue-400 focus:ring-blue-400/50 border-white/30 bg-white/10"},null,8,Ae),[[O,d(l).pricing_tier_id]]),e("div",De,[e("label",{for:`tier-${o.id}`,class:"text-sm font-medium text-white cursor-pointer"},s(o.duration_from)+" "+s(o.duration_unit),9,$e)])]),e("div",ze," ₱"+s(o.price),1)])],10,Se))),128))]),i.errors.pricing_tier_id?(r(),n("div",je,s(i.errors.pricing_tier_id),1)):a("",!0)]),e("div",Le,[e("div",null,[t[21]||(t[21]=e("label",{for:"pickup_date",class:"block text-sm font-medium text-white"},"Pickup Date",-1)),y(e("input",{ref_key:"pickupDateRef",ref:p,type:"date",id:"pickup_date","onUpdate:modelValue":t[1]||(t[1]=o=>d(l).pickup_date=o),min:d(C),onChange:G,onClick:D,onTouchstart:D,class:"mt-1 block w-full bg-white/10 border-white/20 text-white placeholder-white/50 rounded-md shadow-sm focus:ring-blue-400 focus:border-blue-400 sm:text-sm backdrop-blur-sm",required:""},null,40,Ne),[[P,d(l).pickup_date]]),i.errors.pickup_date?(r(),n("div",Ee,s(i.errors.pickup_date),1)):a("",!0)]),e("div",null,[t[22]||(t[22]=e("label",{for:"pickup_time",class:"block text-sm font-medium text-white"},"Pickup Time",-1)),y(e("input",{type:"time",id:"pickup_time","onUpdate:modelValue":t[2]||(t[2]=o=>d(l).pickup_time=o),min:k.value,class:"mt-1 block w-full bg-white/10 border-white/20 text-white placeholder-white/50 rounded-md shadow-sm focus:ring-blue-400 focus:border-blue-400 sm:text-sm backdrop-blur-sm",required:""},null,8,Fe),[[P,d(l).pickup_time]]),i.errors.pickup_time?(r(),n("div",Ue,s(i.errors.pickup_time),1)):a("",!0)])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-white mb-3"},"Payment Method",-1)),e("div",Ye,[(r(!0),n(M,null,S(i.availablePaymentMethods,o=>(r(),n("div",{key:o.id,class:B(["border rounded-lg p-4 cursor-pointer transition-all backdrop-blur-sm",d(l).payment_mode_id==o.id?"border-blue-400 bg-blue-400/20":"border-white/20 hover:border-white/30 hover:bg-white/5"]),onClick:f=>d(l).payment_mode_id=o.id},[e("div",Re,[y(e("input",{type:"radio",id:`mode-${o.id}`,value:o.id,"onUpdate:modelValue":t[3]||(t[3]=f=>d(l).payment_mode_id=f),class:"h-4 w-4 text-blue-400 focus:ring-blue-400/50 border-white/30 bg-white/10"},null,8,qe),[[O,d(l).payment_mode_id]]),e("div",Ge,[e("label",{for:`mode-${o.id}`,class:"text-sm font-medium text-white cursor-pointer"},s(o.name),9,Qe),o.type==="cod"?(r(),n("p",He," Pay when you pick up the vehicle ")):o.type==="gcash"?(r(),n("p",Ie," Pay via GCash using owner's QR code ")):a("",!0)])])],10,Oe))),128)),!i.availablePaymentMethods||i.availablePaymentMethods.length===0?(r(),n("div",Je,t[23]||(t[23]=[e("p",{class:"font-medium text-white"}," No payment methods available ",-1),e("p",{class:"text-sm"}," The owner needs to configure their payment settings. ",-1)]))):a("",!0)]),i.errors.payment_mode_id?(r(),n("div",Ke,s(i.errors.payment_mode_id),1)):a("",!0)]),R.value?(r(),n("div",We,[t[25]||(t[25]=e("label",{for:"reference_number",class:"block text-sm font-medium text-white"},"GCash Reference Number (Optional)",-1)),y(e("input",{type:"text",id:"reference_number","onUpdate:modelValue":t[4]||(t[4]=o=>d(l).reference_number=o),placeholder:"Enter reference number if available",class:"mt-1 block w-full bg-white/10 border-white/20 text-white placeholder-white/50 rounded-md shadow-sm focus:ring-blue-400 focus:border-blue-400 sm:text-sm backdrop-blur-sm"},null,512),[[P,d(l).reference_number]]),i.errors.reference_number?(r(),n("div",Xe,s(i.errors.reference_number),1)):a("",!0)])):a("",!0),_.value?(r(),n("div",Ze,[e("div",et,[t[26]||(t[26]=e("span",{class:"text-lg font-semibold text-white"},"Total Amount:",-1)),e("span",tt,"₱"+s(_.value.price),1)])])):a("",!0),e("button",{type:"submit",disabled:!$.value||!d(l).pricing_tier_id||!d(l).payment_mode_id,class:B(["w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white disabled:opacity-50 disabled:cursor-not-allowed backdrop-blur-sm transition-colors",$.value?"bg-blue-400 hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-400/50":"bg-white/20"])},[g.value?(r(),n("svg",ot,t[27]||(t[27]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):a("",!0),v(" "+s(x.value?"Booking Disabled - Active Booking Exists":g.value?"Creating Booking...":"Create Booking"),1)],10,it)],10,Te)],32)])])])])])])]}),_:1}))}};export{ut as default};
