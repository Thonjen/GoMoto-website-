import{j as G,r as u,q as Q,I as H,a as K,o as i,w as S,b as t,l as W,t as r,g as d,f as n,F as c,h as p,k as h,v as w,z as P,i as N,d as g,u as f,e as k,n as X,S as z,Q as Z}from"./app-D5PUyAMe.js";import{_ as ee}from"./OwnerLayout-R8EC1rpz.js";import{i as te,v as oe,u as le,n as se}from"./vue-leaflet.es-eidY92mW.js";import"./leaflet-icon-fix-CF40O4Io.js";import{_ as ie}from"./FilePondUploader-Ci--PhLg.js";import{t as ne}from"./throttle-Dasc37Bf.js";import"./ResponsiveNavLink-BCB-x7oE.js";import"./Footer-DI0umZVU.js";import"./Header-DdPT2WJT.js";import"./leaflet-src-BthnD9zU.js";import"./filepond-plugin-file-validate-size.esm-DLcP4GBn.js";const ae={class:"bg-white p-6 rounded-lg shadow-md max-w-4xl mx-auto"},re={class:"w-full p-3 bg-gray-100 border border-gray-300 rounded-md text-gray-700 font-medium"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ue=["value"],me=["disabled"],ce={value:""},pe=["value"],ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},be=["max"],ve=["value"],fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ye=["value"],xe=["value"],_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},he={class:"flex items-center"},we={key:0,class:"mb-4"},ke=["src"],Ve={class:"border rounded-lg p-4 bg-gray-50 shadow-sm space-y-4"},Ce={key:0,class:"mt-2 bg-white border rounded-md shadow-lg max-h-40 overflow-y-auto"},Se=["onClick"],Te={class:"text-sm font-medium"},Me={class:"text-xs text-gray-600"},Ue={class:"h-72 rounded overflow-hidden border shadow"},Fe={class:"space-y-2 text-sm bg-white p-4 rounded shadow-inner border"},Le={class:"text-gray-600"},$e={class:"text-gray-600"},je={class:"flex items-center gap-2"},qe=["href"],Pe={class:"border-t pt-6"},Ne={class:"flex items-center justify-between mb-4"},ze=["disabled"],Ae={key:0},Ee={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Be=["value"],De={class:"font-medium"},Ie={class:"text-sm text-gray-600"},Je={key:1,class:"text-sm text-gray-500"},Oe={key:2,class:"text-sm text-gray-500"},Re={class:"text-sm text-gray-500 mt-2"},Ye={class:"border-t pt-6 flex space-x-4"},Ge=["disabled"],it={__name:"Edit",props:{vehicle:Object,makes:Array,models:Array,types:Array,fuelTypes:Array,transmissions:Array},setup(b){const a=b,o=G({make_id:a.vehicle.make_id,model_id:a.vehicle.model_id,type_id:a.vehicle.type_id,fuel_type_id:a.vehicle.fuel_type_id,transmission_id:a.vehicle.transmission_id,license_plate:a.vehicle.license_plate,year:a.vehicle.year,color:a.vehicle.color,description:a.vehicle.description,is_available:a.vehicle.is_available,main_photo_url:a.vehicle.main_photo_url,lat:a.vehicle.lat??9.785903415098108,lng:a.vehicle.lng??125.49062330098809,location_name:a.vehicle.location_name}),A=u(a.makes||[]),y=u(a.models||[]),T=u([]),M=u((a.vehicle.pricing_tiers||[]).map(s=>s.id)),V=u(!1),C=u(!1),v=u(!1),U=u(null);u(null);const x=u(""),_=u([]),F=ne(async()=>{if(o.lat&&o.lng&&!o.location_name)try{const e=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${o.lat}&lon=${o.lng}`)).json();o.location_name=e.display_name||""}catch(s){console.error("Failed to get location name:",s)}},1e3);let L=null;function E(){if(clearTimeout(L),!x.value){_.value=[];return}L=setTimeout(async()=>{const e=`https://photon.komoot.io/api/?q=${encodeURIComponent(x.value)}&limit=5&bbox=125.25,9.77,125.50,9.80`;try{const l=await(await fetch(e)).json();_.value=l.features||[]}catch(m){console.error("Search failed:",m)}},300)}function B(s){o.lat=s.geometry.coordinates[1],o.lng=s.geometry.coordinates[0],x.value=s.properties.name+(s.properties.city?", "+s.properties.city:"")+(s.properties.country?", "+s.properties.country:""),_.value=[]}function D(s){U.value=s}function I(s){o.lat=s.latlng.lat,o.lng=s.latlng.lng}async function $(){if(!o.make_id){o.model_id="",y.value=[];return}V.value=!0;try{const e=await(await fetch(`/api/vehicle-data/models/${o.make_id}`)).json();y.value=e||[],y.value.some(m=>m.id===o.model_id)||(o.model_id="")}catch(s){console.error("Failed to load models:",s),y.value=[],o.model_id=""}finally{V.value=!1}}async function j(){v.value=!0;try{const s=await fetch("/owner/pricing-tiers/list");if(s.ok){const e=await s.json();T.value=e.pricingTiers||[]}}catch(s){console.error("Failed to load pricing tiers:",s)}finally{v.value=!1}}Q(async()=>{await j(),o.make_id&&await $()});async function J(){C.value=!0,await F();const s=new FormData;s.append("make_id",o.make_id),s.append("model_id",o.model_id),s.append("type_id",o.type_id),s.append("fuel_type_id",o.fuel_type_id),s.append("transmission_id",o.transmission_id),s.append("license_plate",o.license_plate||""),s.append("year",o.year),s.append("color",o.color),s.append("description",o.description||""),s.append("is_available",o.is_available?"1":"0"),s.append("lat",o.lat),s.append("lng",o.lng),s.append("location_name",o.location_name||""),U.value&&s.append("main_photo",U.value),s.append("_method","PUT"),s.append("pricing_tier_ids",JSON.stringify(M.value)),Z.post(`/owner/vehicles/${a.vehicle.id}`,s,{onFinish:()=>{C.value=!1},onSuccess:()=>{},onError:e=>{console.error("Update failed:",e)}})}const O={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[125.48545720374489,9.801207813887503],[125.48394937158277,9.801134816678099],[125.4824560626428,9.800916528148765],[125.48099166020462,9.800555050821249],[125.47957026901334,9.800053866380772],[125.47820557937605,9.799417802127778],[125.48545720374489,9.801207813887503]]]}}]},R=()=>({color:"#1976d2",weight:2,fill:!1}),Y=[[9.770890164325817,125.47007455081837],[9.801207813887503,125.50083985667139]];return H(()=>[o.lat,o.lng],()=>{F()}),(s,e)=>(i(),K(ee,null,{default:S(()=>{var m;return[t("div",ae,[e[43]||(e[43]=t("h1",{class:"text-3xl font-bold text-gray-800 mb-6"},"Edit Vehicle",-1)),t("form",{onSubmit:W(J,["prevent"]),class:"space-y-6"},[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Vehicle Category",-1)),t("div",re,r(((m=b.vehicle.type)==null?void 0:m.category)==="car"?"🚗 Car":"🏍️ Motorcycle"),1),e[13]||(e[13]=t("p",{class:"text-xs text-gray-500 mt-1"},"Vehicle category cannot be changed after creation",-1))]),t("div",de,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Make *",-1)),d(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.make_id=l),onChange:$,class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[e[14]||(e[14]=t("option",{value:""},"Select Make",-1)),(i(!0),n(c,null,p(A.value,l=>(i(),n("option",{key:l.id,value:l.id},r(l.name),9,ue))),128))],544),[[h,o.make_id]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Model *",-1)),d(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.model_id=l),class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!o.make_id||V.value,required:""},[t("option",ce,r(V.value?"Loading...":"Select Model"),1),(i(!0),n(c,null,p(y.value,l=>(i(),n("option",{key:l.id,value:l.id},r(l.name),9,pe))),128))],8,me),[[h,o.model_id]])])]),t("div",ge,[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Year *",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.year=l),type:"number",min:"1900",max:new Date().getFullYear()+1,class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,8,be),[[w,o.year]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Transmission *",-1)),d(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>o.transmission_id=l),class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[e[18]||(e[18]=t("option",{value:""},"Select Transmission",-1)),(i(!0),n(c,null,p(b.transmissions,l=>(i(),n("option",{key:l.id,value:l.id},r(l.name),9,ve))),128))],512),[[h,o.transmission_id]])])]),t("div",fe,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fuel Type *",-1)),d(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.fuel_type_id=l),class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[e[20]||(e[20]=t("option",{value:""},"Select Fuel Type",-1)),(i(!0),n(c,null,p(b.fuelTypes,l=>(i(),n("option",{key:l.id,value:l.id},r(l.name),9,ye))),128))],512),[[h,o.fuel_type_id]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Vehicle Sub-Type *",-1)),d(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>o.type_id=l),class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[e[22]||(e[22]=t("option",{value:""},"Select Sub-Type",-1)),(i(!0),n(c,null,p(b.types,l=>(i(),n("option",{key:l.id,value:l.id},r(l.sub_type),9,xe))),128))],512),[[h,o.type_id]])])]),t("div",_e,[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"License Plate",-1)),d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>o.license_plate=l),type:"text",class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter license plate"},null,512),[[w,o.license_plate]]),e[25]||(e[25]=t("p",{class:"text-xs text-gray-500 mt-1"},"Leave blank if not assigned yet",-1))]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Color *",-1)),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>o.color=l),type:"text",class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter vehicle color",required:""},null,512),[[w,o.color]])])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Description",-1)),d(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>o.description=l),rows:"3",class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional description of your vehicle"},null,512),[[w,o.description]])]),t("div",he,[d(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>o.is_available=l),type:"checkbox",id:"is_available",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[P,o.is_available]]),e[28]||(e[28]=t("label",{for:"is_available",class:"ml-2 block text-sm text-gray-700"}," Vehicle is available for rental ",-1))]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Main Photo",-1)),o.main_photo_url?(i(),n("div",we,[e[29]||(e[29]=t("p",{class:"text-sm text-gray-600 mb-2"},"Current Photo",-1)),t("img",{src:o.main_photo_url,alt:"Current main photo",class:"w-48 h-32 object-cover rounded border"},null,8,ke)])):N("",!0),g(ie,{onFileAdded:D})]),t("div",Ve,[e[35]||(e[35]=t("h3",{class:"text-lg font-semibold"},"Vehicle Location",-1)),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Search Location",-1)),d(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>x.value=l),onInput:E,type:"text",placeholder:"Search for a location in Surigao del Norte",class:"w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,544),[[w,x.value]]),_.value.length>0?(i(),n("div",Ce,[(i(!0),n(c,null,p(_.value,l=>(i(),n("div",{key:l.properties.osm_id,onClick:q=>B(l),class:"p-2 hover:bg-gray-100 cursor-pointer border-b last:border-b-0"},[t("div",Te,r(l.properties.name),1),t("div",Me,r(l.properties.city)+", "+r(l.properties.country),1)],8,Se))),128))])):N("",!0)]),t("div",Ue,[g(f(te),{style:{height:"100%"},zoom:16,center:[o.lat,o.lng],"max-bounds":Y,"min-zoom":15,"max-zoom":18,onClick:I},{default:S(()=>[g(f(oe),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),g(f(le),{"lat-lng":[o.lat,o.lng]},null,8,["lat-lng"]),g(f(se),{geojson:O,"options-style":R})]),_:1},8,["center"])]),t("div",Fe,[t("div",null,[e[32]||(e[32]=t("span",{class:"font-medium text-gray-700"},"Coordinates:",-1)),t("span",Le,"Lat "+r(o.lat)+", Lng "+r(o.lng),1)]),t("div",null,[e[33]||(e[33]=t("span",{class:"font-medium text-gray-700"},"Location:",-1)),t("span",$e,r(o.location_name||"—"),1)]),t("div",je,[e[34]||(e[34]=t("span",{class:"font-medium text-gray-700"},"Map Link:",-1)),t("a",{href:`https://www.google.com/maps?q=${o.lat},${o.lng}`,target:"_blank",class:"text-blue-600 hover:text-blue-800 underline"}," View on Google Maps ",8,qe)])])]),t("div",Pe,[t("div",Ne,[e[37]||(e[37]=t("h3",{class:"text-lg font-semibold"},"Pricing",-1)),t("button",{type:"button",onClick:j,disabled:v.value,class:"flex items-center px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 hover:border-blue-400 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[(i(),n("svg",{class:X(["w-4 h-4 mr-1",{"animate-spin":v.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[36]||(e[36]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"},null,-1)]),2)),k(" "+r(v.value?"Refreshing...":"Refresh"),1)],8,ze)]),T.value.length>0?(i(),n("div",Ae,[e[38]||(e[38]=t("p",{class:"text-sm text-gray-600 mb-3"},"Select pricing tiers for this vehicle:",-1)),t("div",Ee,[(i(!0),n(c,null,p(T.value,l=>(i(),n("label",{key:l.id,class:"flex items-center p-3 border rounded-md cursor-pointer hover:bg-gray-50"},[d(t("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":e[11]||(e[11]=q=>M.value=q),class:"mr-3 h-4 w-4 text-blue-600"},null,8,Be),[[P,M.value]]),t("div",null,[t("div",De,r(l.duration_from)+" "+r(l.duration_unit),1),t("div",Ie,"₱"+r(l.price),1)])]))),128))])])):v.value?(i(),n("div",Je," Loading pricing tiers... ")):(i(),n("div",Oe," No pricing tiers available. ")),t("p",Re,[e[40]||(e[40]=k(" You can manage pricing tiers in the ")),g(f(z),{href:"/owner/pricing-tiers",class:"text-blue-600 underline"},{default:S(()=>e[39]||(e[39]=[k("pricing management")])),_:1,__:[39]}),e[41]||(e[41]=k(" section. "))])]),t("div",Ye,[t("button",{type:"submit",disabled:C.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-3 px-6 rounded-md transition-colors"},r(C.value?"Updating Vehicle...":"Update Vehicle"),9,Ge),g(f(z),{href:`/owner/vehicles/${b.vehicle.id}`,class:"bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 px-6 rounded-md transition-colors"},{default:S(()=>e[42]||(e[42]=[k(" Cancel ")])),_:1,__:[42]},8,["href"])])],32)])]}),_:1}))}};export{it as default};
