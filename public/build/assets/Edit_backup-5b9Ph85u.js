import{j as N,r as d,q as z,I as D,f as s,o as i,b as t,d as g,g as u,v as f,k as x,F as p,h as m,e as _,z as E,i as h,w as M,u as w,t as r,l as I,S as O,Q as J}from"./app-D5PUyAMe.js";import{v as R,u as G,n as Q,i as Z}from"./vue-leaflet.es-eidY92mW.js";import"./leaflet-icon-fix-CF40O4Io.js";import{t as Y}from"./throttle-Dasc37Bf.js";import"./leaflet-src-BthnD9zU.js";const H={class:"mb-2"},K={class:"mb-2"},W=["value"],X={class:"mb-2"},ee=["value"],te={class:"mb-2"},le=["value"],oe={class:"mb-2"},ne={class:"mb-2"},se={class:"mb-2"},ie={class:"mb-2"},ae={class:"mb-2"},re={key:0,class:"mt-2"},ue=["src"],de={class:"mb-2"},pe={key:0,class:"border bg-white max-h-40 overflow-y-auto mb-2"},me=["onClick"],ce={key:0},ve={key:1},be={style:{height:"300px"}},ye={class:"space-y-2 text-sm bg-white p-4 rounded shadow-inner border"},ge={class:"text-gray-600"},fe={class:"text-gray-600"},_e={class:"flex items-center gap-2"},he=["href"],we={class:"mt-8"},xe=["value"],ke={key:0,class:"mt-2"},Ve={class:"list-disc ml-6 text-sm"},Se={__name:"Edit_backup",props:{vehicle:Object,brands:Array,types:Array,fuelTypes:Array},setup(c){const a=c,o=N({license_plate:a.vehicle.license_plate,make_id:a.vehicle.make_id,model_id:a.vehicle.model_id,type_id:a.vehicle.type_id,fuel_type_id:a.vehicle.fuel_type_id,transmission_id:a.vehicle.transmission_id,year:a.vehicle.year,color:a.vehicle.color,description:a.vehicle.description,is_available:a.vehicle.is_available,main_photo_url:a.vehicle.main_photo_url,lat:a.vehicle.lat??9.785903415098108,lng:a.vehicle.lng??125.49062330098809,location_name:a.vehicle.location_name}),k=d(null),V=d(null),v=d(""),b=d([]),U=Y(async()=>{if(o.lat&&o.lng&&!o.location_name)try{const e=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${o.lat}&lon=${o.lng}&format=json`)).json();o.location_name=e.display_name||""}catch{o.location_name=""}},1e3);let L=null;function j(){if(clearTimeout(L),!v.value){b.value=[];return}L=setTimeout(async()=>{const e=`https://photon.komoot.io/api/?q=${encodeURIComponent(v.value)}&limit=5&bbox=125.25,9.77,125.50,9.80`,T=await(await fetch(e)).json();b.value=T.features||[]},300)}function S(n){o.lat=n.geometry.coordinates[1],o.lng=n.geometry.coordinates[0],v.value=n.properties.name+(n.properties.city?", "+n.properties.city:"")+(n.properties.country?", "+n.properties.country:""),b.value=[]}function P(n){const e=n.target.files[0];k.value=e,e&&(V.value=URL.createObjectURL(e))}function q(n){o.lat=n.latlng.lat,o.lng=n.latlng.lng}const C=d([]),y=d((a.vehicle.pricing_tiers||[]).map(n=>n.id));z(async()=>{const n=await fetch("/owner/pricing-tiers/list");if(n.ok){const e=await n.json();C.value=e.pricingTiers||[]}});async function $(){await U();const n=new FormData;Object.entries(o).forEach(([e,l])=>{n.append(e,e==="is_available"?l?1:0:l)}),k.value&&n.append("main_photo",k.value),n.append("_method","PUT"),n.append("pricing_tier_ids",JSON.stringify(y.value)),J.post(`/owner/vehicles/${a.vehicle.id}`,n)}const B={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[125.48545720374489,9.801207813887503],[125.48394937158277,9.801134816678099],[125.4824560626428,9.800916528148765],[125.48099166020462,9.800555050821249],[125.47957026901334,9.800053866380772],[125.47820557937605,9.799417802127778],[125.47691073525756,9.79865298446448],[125.4756982076485,9.797766779865192],[125.47457967442702,9.796767723899952],[125.47356590787237,9.79566543899633],[125.47266667091462,9.79447054173279],[125.47189062311993,9.793194540557817],[125.47124523731648,9.791849724921354],[125.47073672766314,9.790449046887577],[125.47036998985222,9.789005996370452],[125.47014855402033,9.787534471194746],[125.47007455081837,9.786048643234757],[125.47014869096546,9.784562821920598],[125.47037025847982,9.78309131642699],[125.47073711764999,9.781648297871861],[125.47124573367556,9.78024766285169],[125.47189120677649,9.77890289962746],[125.47266731943903,9.77762695824917],[125.47356659634224,9.776432125868816],[125.47458037638481,9.775329908441458],[125.47569889611839,9.774330919952476],[125.47691138378202,9.773444780236375],[125.47820616303265,9.772680022369768],[125.47957076537246,9.772044010529008],[125.48099205019147,9.771542869102143],[125.48245633127043,9.771181423736623],[125.48394950852794,9.77096315488939],[125.48545720374489,9.770890164325817],[125.48696489896184,9.77096315488939],[125.48845807621933,9.771181423736623],[125.48992235729831,9.771542869102143],[125.49134364211733,9.772044010529008],[125.49270824445713,9.772680022369768],[125.49400302370776,9.773444780236375],[125.4952155113714,9.774330919952476],[125.49633403110496,9.775329908441458],[125.49734781114755,9.776432125868816],[125.49824708805076,9.77762695824917],[125.49902320071328,9.77890289962746],[125.4996686738142,9.78024766285169],[125.5001772898398,9.781648297871861],[125.50054414900994,9.78309131642699],[125.50076571652433,9.784562821920598],[125.50083985667139,9.786048643234757],[125.50076585346946,9.787534471194746],[125.50054441763756,9.789005996370452],[125.50017767982663,9.790449046887577],[125.4996691701733,9.791849724921354],[125.49902378436985,9.793194540557817],[125.49824773657517,9.79447054173279],[125.4973484996174,9.79566543899633],[125.49633473306275,9.796767723899952],[125.49521619984127,9.797766779865192],[125.49400367223222,9.79865298446448],[125.49270882811372,9.799417802127778],[125.49134413847645,9.800053866380772],[125.48992274728516,9.800555050821249],[125.48845834484696,9.800916528148765],[125.48696503590699,9.801134816678099],[125.48545720374489,9.801207813887503]]]}}]},A=()=>({color:"#1976d2",weight:2,fill:!1}),F=[[9.770890164325817,125.47007455081837],[9.801207813887503,125.50083985667139],[125.49270882811372,9.799417802127778],[125.49134413847645,9.800053866380772],[125.48992274728516,9.800555050821249],[125.48845834484696,9.800916528148765],[125.48696503590699,9.801134816678099],[125.48545720374489,9.801207813887503]];return D(()=>[o.lat,o.lng],()=>{U()}),(n,e)=>(i(),s("div",null,[e[30]||(e[30]=t("h1",{class:"text-2xl font-bold mb-4"},"Edit Vehicle",-1)),t("form",{onSubmit:I($,["prevent"]),enctype:"multipart/form-data"},[t("div",H,[e[10]||(e[10]=t("label",null,"License Plate",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.license_plate=l),class:"border p-2 w-full",required:""},null,512),[[f,o.license_plate]])]),t("div",K,[e[11]||(e[11]=t("label",null,"Brand",-1)),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.brand_id=l),class:"border p-2 w-full",required:""},[(i(!0),s(p,null,m(c.brands,l=>(i(),s("option",{key:l.id,value:l.id},r(l.name),9,W))),128))],512),[[x,o.brand_id]])]),t("div",X,[e[12]||(e[12]=t("label",null,"Type",-1)),u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.type_id=l),class:"border p-2 w-full",required:""},[(i(!0),s(p,null,m(c.types,l=>(i(),s("option",{key:l.id,value:l.id},r(l.category),9,ee))),128))],512),[[x,o.type_id]])]),t("div",te,[e[13]||(e[13]=t("label",null,"Fuel Type",-1)),u(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>o.fuel_type_id=l),class:"border p-2 w-full",required:""},[(i(!0),s(p,null,m(c.fuelTypes,l=>(i(),s("option",{key:l.id,value:l.id},r(l.name),9,le))),128))],512),[[x,o.fuel_type_id]])]),t("div",oe,[e[14]||(e[14]=t("label",null,"Year",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.year=l),type:"number",class:"border p-2 w-full",required:""},null,512),[[f,o.year]])]),t("div",ne,[e[15]||(e[15]=t("label",null,"Color",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>o.color=l),class:"border p-2 w-full",required:""},null,512),[[f,o.color]])]),t("div",se,[e[16]||(e[16]=t("label",null,"Description",-1)),u(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=l=>o.description=l),class:"border p-2 w-full"},null,512),[[f,o.description]])]),t("div",ie,[t("label",null,[u(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>o.is_available=l)},null,512),[[E,o.is_available]]),e[17]||(e[17]=_(" Available "))])]),t("div",ae,[e[18]||(e[18]=t("label",null,"Main Photo",-1)),t("input",{type:"file",onChange:P,accept:"image/*",class:"border p-2 w-full"},null,32),V.value||o.main_photo_url?(i(),s("div",re,[t("img",{src:V.value||o.main_photo_url,class:"w-32 h-24 object-cover rounded"},null,8,ue)])):h("",!0)]),t("div",de,[e[23]||(e[23]=t("label",null,"Location",-1)),u(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>v.value=l),onInput:j,type:"text",placeholder:"Search location...",class:"border p-2 w-full mb-2",autocomplete:"off"},null,544),[[f,v.value]]),b.value.length?(i(),s("ul",pe,[(i(!0),s(p,null,m(b.value,(l,T)=>(i(),s("li",{key:T,onClick:Ce=>S(l),class:"p-2 hover:bg-gray-100 cursor-pointer"},[_(r(l.properties.name),1),l.properties.city?(i(),s("span",ce,", "+r(l.properties.city),1)):h("",!0),l.properties.country?(i(),s("span",ve,", "+r(l.properties.country),1)):h("",!0)],8,me))),128))])):h("",!0),t("div",be,[g(w(Z),{style:{height:"100%"},zoom:20,center:[o.lat,o.lng],maxBounds:F,minZoom:15,maxZoom:18,onClick:q},{default:M(()=>[g(w(R),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),g(w(G),{"lat-lng":[o.lat,o.lng]},null,8,["lat-lng"]),g(w(Q),{geojson:B,"options-style":A})]),_:1},8,["center"])]),t("div",ye,[t("div",null,[e[19]||(e[19]=t("span",{class:"font-medium text-gray-700"},"Coordinates:",-1)),t("span",ge,"Lat "+r(o.lat)+", Lng "+r(o.lng),1)]),t("div",null,[e[20]||(e[20]=t("span",{class:"font-medium text-gray-700"},"Location:",-1)),t("span",fe,r(o.location_name||"â€”"),1)]),t("div",_e,[e[22]||(e[22]=t("span",{class:"font-medium text-gray-700"},"Map Link:",-1)),t("a",{href:`https://www.google.com/maps?q=${o.lat},${o.lng}`,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center text-blue-600 hover:text-blue-800 underline transition"},e[21]||(e[21]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 20l-5.447-2.724A2 2 0 013 15.382V5a2 2 0 012-2h14a2 2 0 012 2v10.382a2 2 0 01-1.553 1.894L15 20l-3-1.5L9 20z"})],-1),t("span",null,"View on Google Maps",-1)]),8,he)])])]),t("div",we,[e[27]||(e[27]=t("h2",{class:"text-xl font-bold mb-2"},"Pricing",-1)),t("div",null,[e[25]||(e[25]=t("label",{class:"block font-medium mb-1"},"Select Pricing Tiers:",-1)),u(t("select",{"onUpdate:modelValue":e[9]||(e[9]=l=>y.value=l),multiple:"",class:"border p-2 rounded w-full max-w-lg"},[(i(!0),s(p,null,m(C.value,l=>(i(),s("option",{key:l.id,value:l.id},r(l.duration_from)+" "+r(l.duration_unit)+" - â‚±"+r(l.price),9,xe))),128))],512),[[x,y.value]]),e[26]||(e[26]=t("div",{class:"text-xs text-gray-500 mt-1"},[_(" Manage your pricing tiers "),t("a",{href:"/owner/pricing-tiers",class:"text-blue-600 underline"},"here"),_(". ")],-1)),y.value.length?(i(),s("div",ke,[e[24]||(e[24]=t("span",{class:"font-semibold text-sm"},"Currently Associated Tiers:",-1)),t("ul",Ve,[(i(!0),s(p,null,m(C.value.filter(l=>y.value.includes(l.id)),l=>(i(),s("li",{key:l.id},r(l.duration_from)+" "+r(l.duration_unit)+" - â‚±"+r(l.price),1))),128))])])):h("",!0)])]),e[28]||(e[28]=t("button",{class:"bg-blue-600 text-white px-4 py-2 rounded"},"Update",-1))],32),g(w(O),{href:`/owner/vehicles/${c.vehicle.id}`,class:"ml-2 text-blue-600"},{default:M(()=>e[29]||(e[29]=[_("Back")])),_:1,__:[29]},8,["href"])]))}};export{Se as default};
