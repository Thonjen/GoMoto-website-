import{j as R,r as u,q as Y,I as G,a as Q,o as i,w as V,b as t,l as H,g as d,f as r,F as m,h as c,t as a,k as x,v as h,z as $,i as S,d as p,u as g,e as U,S as q,Q as K}from"./app-D5PUyAMe.js";import{_ as W}from"./OwnerLayout-R8EC1rpz.js";import{i as X,v as Z,u as ee,n as te}from"./vue-leaflet.es-eidY92mW.js";import"./leaflet-icon-fix-CF40O4Io.js";import{t as oe}from"./throttle-Dasc37Bf.js";import"./ResponsiveNavLink-BCB-x7oE.js";import"./Footer-DI0umZVU.js";import"./Header-DdPT2WJT.js";import"./leaflet-src-BthnD9zU.js";const le={class:"bg-white p-6 rounded-lg shadow-md max-w-4xl mx-auto"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ie=["value"],ne=["disabled"],re={value:""},ae=["value"],de={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ue=["max"],me=["value"],ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pe=["value"],ge=["value"],fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},be={class:"flex items-center"},ve={class:"mt-4 flex gap-4"},ye={key:0,class:"text-center"},xe=["src"],he={key:1,class:"text-center"},_e=["src"],we={class:"border rounded-lg p-4 bg-gray-50 shadow-sm space-y-4"},ke={key:0,class:"mt-2 bg-white border rounded-md shadow-lg max-h-40 overflow-y-auto"},Ve=["onClick"],Se={class:"text-sm font-medium"},Ue={class:"text-xs text-gray-600"},Ce={class:"h-72 rounded overflow-hidden border shadow"},Te={class:"space-y-2 text-sm bg-white p-4 rounded shadow-inner border"},Me={class:"text-gray-600"},Le={class:"text-gray-600"},je={class:"flex items-center gap-2"},Fe=["href"],Pe={class:"border-t pt-6"},$e={key:0},qe={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ne=["value"],Ee={class:"font-medium"},ze={class:"text-sm text-gray-600"},Ae={class:"text-sm text-gray-500 mt-2"},De={class:"border-t pt-6 flex space-x-4"},Oe=["disabled"],We={__name:"EditNew",props:{vehicle:Object,makes:Array,models:Array,types:Array,fuelTypes:Array,transmissions:Array},setup(f){const n=f,l=R({make_id:n.vehicle.make_id,model_id:n.vehicle.model_id,type_id:n.vehicle.type_id,fuel_type_id:n.vehicle.fuel_type_id,transmission_id:n.vehicle.transmission_id,license_plate:n.vehicle.license_plate,year:n.vehicle.year,color:n.vehicle.color,description:n.vehicle.description,is_available:n.vehicle.is_available,main_photo_url:n.vehicle.main_photo_url,lat:n.vehicle.lat??9.785903415098108,lng:n.vehicle.lng??125.49062330098809,location_name:n.vehicle.location_name}),N=u(n.makes||[]),_=u(n.models||[]),C=u([]),T=u((n.vehicle.pricing_tiers||[]).map(s=>s.id)),w=u(!1),b=u(!1),M=u(null),L=u(null),v=u(""),y=u([]),j=oe(async()=>{if(l.lat&&l.lng&&!l.location_name)try{const e=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${l.lat}&lon=${l.lng}`)).json();l.location_name=e.display_name||""}catch(s){console.error("Failed to get location name:",s)}},1e3);let F=null;function E(){if(clearTimeout(F),!v.value){y.value=[];return}F=setTimeout(async()=>{const e=`https://photon.komoot.io/api/?q=${encodeURIComponent(v.value)}&limit=5&bbox=125.25,9.77,125.50,9.80`;try{const k=await(await fetch(e)).json();y.value=k.features||[]}catch(o){console.error("Search failed:",o)}},300)}function z(s){l.lat=s.geometry.coordinates[1],l.lng=s.geometry.coordinates[0],v.value=s.properties.name+(s.properties.city?", "+s.properties.city:"")+(s.properties.country?", "+s.properties.country:""),y.value=[]}function A(s){const e=s.target.files[0];M.value=e,e&&(L.value=URL.createObjectURL(e))}function D(s){l.lat=s.latlng.lat,l.lng=s.latlng.lng}async function P(){if(l.model_id="",!l.make_id){_.value=[];return}w.value=!0;try{const e=await(await fetch(`/api/makes/${l.make_id}/models`)).json();_.value=e.models||[]}catch(s){console.error("Failed to load models:",s),_.value=[]}finally{w.value=!1}}Y(async()=>{try{const s=await fetch("/owner/pricing-tiers/list");if(s.ok){const e=await s.json();C.value=e.pricingTiers||[]}}catch(s){console.error("Failed to load pricing tiers:",s)}l.make_id&&await P()});async function O(){b.value=!0,await j();const s=new FormData;Object.entries(l).forEach(([e,o])=>{e==="is_available"?s.append(e,o?1:0):o!=null&&s.append(e,o)}),M.value&&s.append("main_photo",M.value),s.append("_method","PUT"),s.append("pricing_tier_ids",JSON.stringify(T.value));try{K.post(`/owner/vehicles/${n.vehicle.id}`,s,{onFinish:()=>{b.value=!1}})}catch(e){console.error("Update failed:",e),b.value=!1}}const B={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[125.48545720374489,9.801207813887503],[125.48394937158277,9.801134816678099],[125.4824560626428,9.800916528148765],[125.48099166020462,9.800555050821249],[125.47957026901334,9.800053866380772],[125.47820557937605,9.799417802127778],[125.48545720374489,9.801207813887503]]]}}]},I=()=>({color:"#1976d2",weight:2,fill:!1}),J=[[9.770890164325817,125.47007455081837],[9.801207813887503,125.50083985667139]];return G(()=>[l.lat,l.lng],()=>{j()}),(s,e)=>(i(),Q(W,null,{default:V(()=>[t("div",le,[e[41]||(e[41]=t("h1",{class:"text-3xl font-bold text-gray-800 mb-6"},"Edit Vehicle",-1)),t("form",{onSubmit:H(O,["prevent"]),class:"space-y-6"},[t("div",se,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Make *",-1)),d(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.make_id=o),onChange:P,class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[e[12]||(e[12]=t("option",{value:""},"Select Make",-1)),(i(!0),r(m,null,c(N.value,o=>(i(),r("option",{key:o.id,value:o.id},a(o.name),9,ie))),128))],544),[[x,l.make_id]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Model *",-1)),d(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.model_id=o),class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!l.make_id||w.value,required:""},[t("option",re,a(w.value?"Loading...":"Select Model"),1),(i(!0),r(m,null,c(_.value,o=>(i(),r("option",{key:o.id,value:o.id},a(o.name),9,ae))),128))],8,ne),[[x,l.model_id]])])]),t("div",de,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Year *",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.year=o),type:"number",min:"1900",max:new Date().getFullYear()+1,class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,8,ue),[[h,l.year]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Transmission *",-1)),d(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>l.transmission_id=o),class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[e[16]||(e[16]=t("option",{value:""},"Select Transmission",-1)),(i(!0),r(m,null,c(f.transmissions,o=>(i(),r("option",{key:o.id,value:o.id},a(o.name),9,me))),128))],512),[[x,l.transmission_id]])])]),t("div",ce,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fuel Type *",-1)),d(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>l.fuel_type_id=o),class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[e[18]||(e[18]=t("option",{value:""},"Select Fuel Type",-1)),(i(!0),r(m,null,c(f.fuelTypes,o=>(i(),r("option",{key:o.id,value:o.id},a(o.name),9,pe))),128))],512),[[x,l.fuel_type_id]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Vehicle Sub-Type *",-1)),d(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>l.type_id=o),class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[e[20]||(e[20]=t("option",{value:""},"Select Sub-Type",-1)),(i(!0),r(m,null,c(f.types,o=>(i(),r("option",{key:o.id,value:o.id},a(o.sub_type),9,ge))),128))],512),[[x,l.type_id]])])]),t("div",fe,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"License Plate",-1)),d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>l.license_plate=o),type:"text",class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter license plate"},null,512),[[h,l.license_plate]]),e[23]||(e[23]=t("p",{class:"text-xs text-gray-500 mt-1"},"Leave blank if not assigned yet",-1))]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Color *",-1)),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>l.color=o),type:"text",class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter vehicle color",required:""},null,512),[[h,l.color]])])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Description",-1)),d(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=o=>l.description=o),rows:"3",class:"w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional description of your vehicle"},null,512),[[h,l.description]])]),t("div",be,[d(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>l.is_available=o),type:"checkbox",id:"is_available",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[$,l.is_available]]),e[26]||(e[26]=t("label",{for:"is_available",class:"ml-2 block text-sm text-gray-700"}," Vehicle is available for rental ",-1))]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Main Photo",-1)),t("input",{type:"file",onChange:A,accept:"image/*",class:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,32),t("div",ve,[l.main_photo_url?(i(),r("div",ye,[e[27]||(e[27]=t("p",{class:"text-sm text-gray-600 mb-2"},"Current Photo",-1)),t("img",{src:l.main_photo_url,alt:"Current main photo",class:"w-32 h-24 object-cover rounded border"},null,8,xe)])):S("",!0),L.value?(i(),r("div",he,[e[28]||(e[28]=t("p",{class:"text-sm text-gray-600 mb-2"},"New Photo",-1)),t("img",{src:L.value,alt:"New main photo preview",class:"w-32 h-24 object-cover rounded border"},null,8,_e)])):S("",!0)])]),t("div",we,[e[34]||(e[34]=t("h3",{class:"text-lg font-semibold"},"Vehicle Location",-1)),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Search Location",-1)),d(t("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>v.value=o),onInput:E,type:"text",placeholder:"Search for a location in Surigao del Norte",class:"w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,544),[[h,v.value]]),y.value.length>0?(i(),r("div",ke,[(i(!0),r(m,null,c(y.value,o=>(i(),r("div",{key:o.properties.osm_id,onClick:k=>z(o),class:"p-2 hover:bg-gray-100 cursor-pointer border-b last:border-b-0"},[t("div",Se,a(o.properties.name),1),t("div",Ue,a(o.properties.city)+", "+a(o.properties.country),1)],8,Ve))),128))])):S("",!0)]),t("div",Ce,[p(g(X),{style:{height:"100%"},zoom:16,center:[l.lat,l.lng],"max-bounds":J,"min-zoom":15,"max-zoom":18,onClick:D},{default:V(()=>[p(g(Z),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),p(g(ee),{"lat-lng":[l.lat,l.lng]},null,8,["lat-lng"]),p(g(te),{geojson:B,"options-style":I})]),_:1},8,["center"])]),t("div",Te,[t("div",null,[e[31]||(e[31]=t("span",{class:"font-medium text-gray-700"},"Coordinates:",-1)),t("span",Me,"Lat "+a(l.lat)+", Lng "+a(l.lng),1)]),t("div",null,[e[32]||(e[32]=t("span",{class:"font-medium text-gray-700"},"Location:",-1)),t("span",Le,a(l.location_name||"—"),1)]),t("div",je,[e[33]||(e[33]=t("span",{class:"font-medium text-gray-700"},"Map Link:",-1)),t("a",{href:`https://www.google.com/maps?q=${l.lat},${l.lng}`,target:"_blank",class:"text-blue-600 hover:text-blue-800 underline"}," View on Google Maps ",8,Fe)])])]),t("div",Pe,[e[39]||(e[39]=t("h3",{class:"text-lg font-semibold mb-4"},"Pricing",-1)),C.value.length>0?(i(),r("div",$e,[e[35]||(e[35]=t("p",{class:"text-sm text-gray-600 mb-3"},"Select pricing tiers for this vehicle:",-1)),t("div",qe,[(i(!0),r(m,null,c(C.value,o=>(i(),r("label",{key:o.id,class:"flex items-center p-3 border rounded-md cursor-pointer hover:bg-gray-50"},[d(t("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":e[11]||(e[11]=k=>T.value=k),class:"mr-3 h-4 w-4 text-blue-600"},null,8,Ne),[[$,T.value]]),t("div",null,[t("div",Ee,a(o.duration_from)+" "+a(o.duration_unit),1),t("div",ze,"₱"+a(o.price),1)])]))),128))])])):S("",!0),t("p",Ae,[e[37]||(e[37]=U(" You can manage pricing tiers in the ")),p(g(q),{href:"/owner/pricing-tiers",class:"text-blue-600 underline"},{default:V(()=>e[36]||(e[36]=[U("pricing management")])),_:1,__:[36]}),e[38]||(e[38]=U(" section. "))])]),t("div",De,[t("button",{type:"submit",disabled:b.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-3 px-6 rounded-md transition-colors"},a(b.value?"Updating Vehicle...":"Update Vehicle"),9,Oe),p(g(q),{href:`/owner/vehicles/${f.vehicle.id}`,class:"bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 px-6 rounded-md transition-colors"},{default:V(()=>e[40]||(e[40]=[U(" Cancel ")])),_:1,__:[40]},8,["href"])])],32)])]),_:1}))}};export{We as default};
