import{r as u,j as I,q as z,I as J,a as O,o as s,w as T,b as t,l as R,g as a,v as g,f as r,F as d,h as m,t as i,k as b,d as v,i as w,e as V,u as x,Q as G}from"./app-D5PUyAMe.js";import{_ as Q}from"./OwnerLayout-R8EC1rpz.js";import{i as Z,v as Y,u as H,n as K}from"./vue-leaflet.es-eidY92mW.js";import"./leaflet-icon-fix-CF40O4Io.js";import{_ as W}from"./FilePondUploader-Ci--PhLg.js";import{t as X}from"./throttle-Dasc37Bf.js";import"./ResponsiveNavLink-BCB-x7oE.js";import"./Footer-DI0umZVU.js";import"./Header-DdPT2WJT.js";import"./leaflet-src-BthnD9zU.js";import"./filepond-plugin-file-validate-size.esm-DLcP4GBn.js";const ee={class:"md:col-span-3 bg-white p-6 rounded-lg shadow-md"},te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe=["value"],le=["disabled"],ne=["value"],se=["value"],re=["value"],ie={key:0,class:"mt-3"},ae=["src"],ue={class:"border rounded-lg p-4 bg-gray-50 shadow-sm space-y-4"},de={key:0,class:"border mt-2 bg-white max-h-48 overflow-y-auto rounded shadow"},me=["onClick"],pe={key:0},ce={key:1},fe={class:"h-72 rounded overflow-hidden border shadow"},ge={class:"space-y-2 text-sm bg-white p-4 rounded shadow-inner border"},be={class:"text-gray-600"},ve={class:"text-gray-600"},ye={class:"flex items-center gap-2"},we=["href"],xe={class:"mt-8"},ke=["value"],Pe={__name:"Create",props:{makes:Array,types:Array,fuelTypes:Array,transmissions:Array},setup(M){const L=u("Fetching location..."),S=u([]),p=u([]),l=I({license_plate:"",make_id:"",model_id:"",type_id:"",fuel_type_id:"",transmission_id:"",year:"",color:"",description:"",is_available:!0,lat:9.785903415098108,lng:125.49062330098809,location_name:""}),j=X(async()=>{if(l.lat&&l.lng)try{const e=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${l.lat}&lon=${l.lng}&format=json`)).json();l.location_name=e.display_name}catch{L.value="Unknown location",l.location_name=""}},1e3),k=u(null),y=u(null),c=u(""),f=u([]);let C=null;function q(){if(clearTimeout(C),!c.value){f.value=[];return}const n="125.25,9.77,125.50,9.80";C=setTimeout(async()=>{const e=`https://photon.komoot.io/api/?q=${encodeURIComponent(c.value)}&limit=5&bbox=${n}`,h=await(await fetch(e)).json();f.value=h.features||[]},300)}function $(n){l.lat=n.geometry.coordinates[1],l.lng=n.geometry.coordinates[0],c.value=n.properties.name+(n.properties.city?", "+n.properties.city:"")+(n.properties.country?", "+n.properties.country:""),f.value=[]}function P(n){k.value=n,n?y.value=URL.createObjectURL(n):y.value=null}function A(n){l.lat=n.latlng.lat,l.lng=n.latlng.lng}const U=u([]),_=u([]);z(async()=>{const n=await fetch("/owner/pricing-tiers/list");if(n.ok){const e=await n.json();U.value=e.pricingTiers||[]}await loadMakes()});async function F(){if(!l.make_id){p.value=[],l.model_id="";return}try{const n=await fetch(`/api/vehicle-data/models/${l.make_id}`);n.ok?p.value=await n.json():p.value=[]}catch(n){console.error("Error loading models:",n),p.value=[]}}function N(){const n=new FormData;Object.entries(l).forEach(([e,o])=>{e==="is_available"?n.append("is_available",o?1:0):n.append(e,o)}),k.value&&n.append("main_photo",k.value),n.append("pricing_tier_ids",JSON.stringify(_.value)),G.post("/owner/vehicles",n)}const B={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[125.48545720374489,9.801207813887503],[125.48394937158277,9.801134816678099],[125.4824560626428,9.800916528148765],[125.48099166020462,9.800555050821249],[125.47957026901334,9.800053866380772],[125.47820557937605,9.799417802127778],[125.47691073525756,9.79865298446448],[125.4756982076485,9.797766779865192],[125.47457967442702,9.796767723899952],[125.47356590787237,9.79566543899633],[125.47266667091462,9.79447054173279],[125.47189062311993,9.793194540557817],[125.47124523731648,9.791849724921354],[125.47073672766314,9.790449046887577],[125.47036998985222,9.789005996370452],[125.47014855402033,9.787534471194746],[125.47007455081837,9.786048643234757],[125.47014869096546,9.784562821920598],[125.47037025847982,9.78309131642699],[125.47073711764999,9.781648297871861],[125.47124573367556,9.78024766285169],[125.47189120677649,9.77890289962746],[125.47266731943903,9.77762695824917],[125.47356659634224,9.776432125868816],[125.47458037638481,9.775329908441458],[125.47569889611839,9.774330919952476],[125.47691138378202,9.773444780236375],[125.47820616303265,9.772680022369768],[125.47957076537246,9.772044010529008],[125.48099205019147,9.771542869102143],[125.48245633127043,9.771181423736623],[125.48394950852794,9.77096315488939],[125.48545720374489,9.770890164325817],[125.48696489896184,9.77096315488939],[125.48845807621933,9.771181423736623],[125.48992235729831,9.771542869102143],[125.49134364211733,9.772044010529008],[125.49270824445713,9.772680022369768],[125.49400302370776,9.773444780236375],[125.4952155113714,9.774330919952476],[125.49633403110496,9.775329908441458],[125.49734781114755,9.776432125868816],[125.49824708805076,9.77762695824917],[125.49902320071328,9.77890289962746],[125.4996686738142,9.78024766285169],[125.5001772898398,9.781648297871861],[125.50054414900994,9.78309131642699],[125.50076571652433,9.784562821920598],[125.50083985667139,9.786048643234757],[125.50076585346946,9.787534471194746],[125.50054441763756,9.789005996370452],[125.50017767982663,9.790449046887577],[125.4996691701733,9.791849724921354],[125.49902378436985,9.793194540557817],[125.49824773657517,9.79447054173279],[125.4973484996174,9.79566543899633],[125.49633473306275,9.796767723899952],[125.49521619984127,9.797766779865192],[125.49400367223222,9.79865298446448],[125.49270882811372,9.799417802127778],[125.49134413847645,9.800053866380772],[125.48992274728516,9.800555050821249],[125.48845834484696,9.800916528148765],[125.48696503590699,9.801134816678099],[125.48545720374489,9.801207813887503]]]}}]},D=()=>({color:"#1976d2",weight:2,fill:!1}),E=[[9.770890164325817,125.47007455081837],[9.801207813887503,125.50083985667139],[125.49270882811372,9.799417802127778],[125.49134413847645,9.800053866380772],[125.48992274728516,9.800555050821249],[125.48845834484696,9.800916528148765],[125.48696503590699,9.801134816678099],[125.48545720374489,9.801207813887503]];return J(()=>[l.lat,l.lng],()=>{j()},{immediate:!0}),(n,e)=>(s(),O(Q,null,{default:T(()=>[t("div",ee,[e[30]||(e[30]=t("h1",{class:"text-3xl font-bold text-gray-800 mb-6"}," Add New Vehicle ",-1)),t("form",{onSubmit:R(N,["prevent"]),enctype:"multipart/form-data",class:"space-y-6"},[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"License Plate",-1)),a(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.license_plate=o),class:"w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-400",required:""},null,512),[[g,l.license_plate]])]),t("div",te,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Make",-1)),a(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.make_id=o),onChange:F,class:"w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-400",required:""},[e[11]||(e[11]=t("option",{value:""},"Select Make",-1)),(s(!0),r(d,null,m(S.value,o=>(s(),r("option",{key:o.id,value:o.id},i(o.name),9,oe))),128))],544),[[b,l.make_id]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Model",-1)),a(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.model_id=o),class:"w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-400",required:"",disabled:!l.make_id},[e[13]||(e[13]=t("option",{value:""},"Select Model",-1)),(s(!0),r(d,null,m(p.value,o=>(s(),r("option",{key:o.id,value:o.id},i(o.name),9,ne))),128))],8,le),[[b,l.model_id]])])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Type",-1)),a(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>l.type_id=o),class:"w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-400",required:""},[(s(!0),r(d,null,m(M.types,o=>(s(),r("option",{key:o.id,value:o.id},i(o.category),9,se))),128))],512),[[b,l.type_id]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fuel Type",-1)),a(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>l.fuel_type_id=o),class:"w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-400",required:""},[(s(!0),r(d,null,m(M.fuelTypes,o=>(s(),r("option",{key:o.id,value:o.id},i(o.name),9,re))),128))],512),[[b,l.fuel_type_id]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Year",-1)),a(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>l.year=o),type:"number",class:"w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-400",required:""},null,512),[[g,l.year]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Color",-1)),a(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>l.color=o),class:"w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-400",required:""},null,512),[[g,l.color]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Description",-1)),a(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=o=>l.description=o),class:"w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-400",rows:"4"},null,512),[[g,l.description]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Main Photo",-1)),v(W,{"allow-multiple":!1,"accepted-file-types":["image/*"],onFileAdded:P}),y.value?(s(),r("div",ie,[t("img",{src:y.value,class:"w-40 h-28 object-cover rounded shadow"},null,8,ae)])):w("",!0)]),t("div",ue,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Search Location",-1)),a(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>c.value=o),onInput:q,type:"text",placeholder:"Enter location...",class:"w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-400"},null,544),[[g,c.value]]),f.value.length?(s(),r("ul",de,[(s(!0),r(d,null,m(f.value,(o,h)=>(s(),r("li",{key:h,onClick:_e=>$(o),class:"p-2 hover:bg-gray-100 cursor-pointer text-sm"},[V(i(o.properties.name)+" ",1),o.properties.city?(s(),r("span",pe,", "+i(o.properties.city),1)):w("",!0),o.properties.country?(s(),r("span",ce,", "+i(o.properties.country),1)):w("",!0)],8,me))),128))])):w("",!0)]),t("div",fe,[v(x(Z),{style:{height:"100%"},zoom:20,center:[l.lat,l.lng],maxBounds:E,minZoom:15,maxZoom:18,onClick:A},{default:T(()=>[v(x(Y),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),v(x(H),{"lat-lng":[l.lat,l.lng]},null,8,["lat-lng"]),v(x(K),{geojson:B,"options-style":D})]),_:1},8,["center"])]),t("div",ge,[t("div",null,[e[22]||(e[22]=t("span",{class:"font-medium text-gray-700"},"Coordinates:",-1)),t("span",be,"Lat "+i(l.lat)+", Lng "+i(l.lng),1)]),t("div",null,[e[23]||(e[23]=t("span",{class:"font-medium text-gray-700"},"Location:",-1)),t("span",ve,i(l.location_name),1)]),t("div",ye,[e[25]||(e[25]=t("span",{class:"font-medium text-gray-700"},"Map Link:",-1)),t("a",{href:`https://www.google.com/maps?q=${l.lat},${l.lng}`,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center text-blue-600 hover:text-blue-800 underline transition"},e[24]||(e[24]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 20l-5.447-2.724A2 2 0 013 15.382V5a2 2 0 012-2h14a2 2 0 012 2v10.382a2 2 0 01-1.553 1.894L15 20l-3-1.5L9 20z"})],-1),t("span",null,"View on Google Maps",-1)]),8,we)])])]),t("div",xe,[e[28]||(e[28]=t("h2",{class:"text-xl font-bold mb-2"},"Pricing",-1)),t("div",null,[e[26]||(e[26]=t("label",{class:"block font-medium mb-1"},"Select Pricing Tiers:",-1)),a(t("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>_.value=o),multiple:"",class:"border p-2 rounded w-full max-w-lg"},[(s(!0),r(d,null,m(U.value,o=>(s(),r("option",{key:o.id,value:o.id},i(o.duration_from)+" "+i(o.duration_unit)+" - â‚±"+i(o.price),9,ke))),128))],512),[[b,_.value]]),e[27]||(e[27]=t("div",{class:"text-xs text-gray-500 mt-1"},[V(" Manage your pricing tiers "),t("a",{href:"/owner/pricing-tiers",class:"text-blue-600 underline"},"here"),V(". ")],-1))])]),e[29]||(e[29]=t("div",{class:"pt-2"},[t("button",{type:"submit",class:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition"}," Save Vehicle ")],-1))],32)])]),_:1}))}};export{Pe as default};
