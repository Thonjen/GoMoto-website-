import{r as E,x as q,c as y,a as H,o as r,w as N,b as e,e as m,t as o,f as n,i as a,F as h,h as _,d as Y,u as d,S as I,l as J,n as p,g as x,B as F,v as w,Q as K}from"./app-D5PUyAMe.js";import{_ as W}from"./AuthenticatedLayout-B-cZbXuZ.js";import"./Footer-DI0umZVU.js";import"./Header-DdPT2WJT.js";import"./ResponsiveNavLink-BCB-x7oE.js";const X={class:"py-12"},Z={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},ee={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},te={class:"p-6 text-gray-900"},ie={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},se={class:"bg-gray-50 p-6 rounded-lg mb-6"},oe=["src","alt"],le={class:"text-lg font-semibold"},re={class:"text-gray-600"},ne={class:"mt-4 grid grid-cols-2 gap-4 text-sm text-gray-700"},de={key:0,class:"mb-6 p-4 bg-red-100 border-l-4 border-red-500 text-red-700"},ae={class:"flex"},ue={class:"ml-3"},ce={class:"mt-2 text-sm"},me={class:"list-disc list-inside space-y-1"},ve={key:0},ge={key:1},be={key:2},fe={key:3},ye={key:1,class:"mb-6 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700"},xe={class:"flex"},pe={class:"ml-3"},ke={class:"mt-2 text-sm"},he={class:"list-disc list-inside space-y-1"},_e={class:"mt-2"},we=["disabled"],Be={class:"space-y-3"},Ce=["onClick"],Me={class:"flex items-center justify-between"},Se={class:"flex items-center"},Ve=["id","value"],Te={class:"ml-3"},Pe=["for"],Ae={class:"text-lg font-bold text-green-600"},De={key:0,class:"mt-2 text-sm text-red-600"},$e={class:"grid grid-cols-2 gap-4"},je=["min"],ze={key:0,class:"mt-2 text-sm text-red-600"},Le=["min"],Ee={key:0,class:"mt-2 text-sm text-red-600"},Ne={class:"space-y-3"},Fe=["onClick"],Ue={class:"flex items-center"},Oe=["id","value"],Re={class:"ml-3"},Ge=["for"],Qe={key:0,class:"text-xs text-gray-500"},qe={key:1,class:"text-xs text-gray-500"},He={key:0,class:"text-center py-8 text-gray-500 border border-gray-200 rounded-lg"},Ye={key:0,class:"mt-2 text-sm text-red-600"},Ie={key:0},Je={key:0,class:"mt-2 text-sm text-red-600"},Ke={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-4"},We={class:"flex justify-between items-center"},Xe={class:"text-2xl font-bold text-green-600"},Ze=["disabled"],et={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},nt={__name:"Create",props:{vehicle:Object,availablePaymentMethods:Array,errors:Object,userActiveBookings:Array},setup(i){const u=i,g=E(!1),k=new Date().toISOString().split("T")[0],B=new Date().toTimeString().slice(0,5),l=q({pricing_tier_id:null,pickup_date:k,pickup_time:B,payment_mode_id:null,reference_number:""}),C=y(()=>l.pricing_tier_id?u.vehicle.pricing_tiers.find(c=>c.id==l.pricing_tier_id):null),U=y(()=>{if(!l.payment_mode_id)return!1;const c=u.availablePaymentMethods.find(t=>t.id==l.payment_mode_id);return(c==null?void 0:c.type)==="gcash"}),O=y(()=>u.errors&&(u.errors.booking_conflict||u.errors.vehicle_unavailable||u.errors.rate_limit||u.errors.user_booking_conflict)),b=E(B);function R(){const c=k;if(l.pickup_date===c){const t=new Date;b.value=t.toTimeString().slice(0,5),l.pickup_time<b.value&&(l.pickup_time=b.value)}else b.value="00:00"}const f=y(()=>u.userActiveBookings&&u.userActiveBookings.length>0),M=y(()=>!f.value&&!g.value);function G(){g.value||(g.value=!0,l.post(route("bookings.store",u.vehicle.id),{onSuccess:()=>{},onError:c=>{g.value=!1,console.log("Booking errors:",c)},onFinish:()=>{g.value=!1}}))}function Q(){window.history.length>1?window.history.back():K.visit(`/vehicles/${u.vehicle.id}`)}return(c,t)=>(r(),H(W,null,{default:N(()=>{var S,V,T,P,A,D,$,j,z;return[e("div",X,[e("div",Z,[e("div",ee,[e("div",te,[e("div",{class:"mb-6"},[e("button",{onClick:Q,class:"inline-flex items-center text-primary-600 hover:text-primary-800 font-semibold transition-colors"},t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),m(" Back to Vehicle ")]))]),t[28]||(t[28]=e("h1",{class:"text-3xl font-bold text-gray-800 mb-8"}," Book Vehicle ",-1)),e("div",ie,[e("div",null,[e("div",se,[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold mb-4"}," Vehicle Details ",-1)),e("img",{src:i.vehicle.main_photo_url||"/images/placeholder-vehicle.jpg",alt:`${(S=i.vehicle.make)==null?void 0:S.name} ${((V=i.vehicle.model)==null?void 0:V.name)||((T=i.vehicle.type)==null?void 0:T.sub_type)}`,class:"w-full h-48 object-cover rounded-lg mb-4"},null,8,oe),e("h3",le,o((P=i.vehicle.make)==null?void 0:P.name)+" "+o(((A=i.vehicle.model)==null?void 0:A.name)||((D=i.vehicle.type)==null?void 0:D.sub_type)),1),e("p",re,o(i.vehicle.description),1),e("div",ne,[e("div",null,[t[6]||(t[6]=e("strong",null,"Year:",-1)),m(" "+o(i.vehicle.year),1)]),e("div",null,[t[7]||(t[7]=e("strong",null,"Color:",-1)),m(" "+o(i.vehicle.color),1)]),e("div",null,[t[8]||(t[8]=e("strong",null,"Fuel:",-1)),m(" "+o((($=i.vehicle.fuelTypes)==null?void 0:$.name)||((j=i.vehicle.fuel_type)==null?void 0:j.name)),1)]),e("div",null,[t[9]||(t[9]=e("strong",null,"Transmission:",-1)),m(" "+o(((z=i.vehicle.transmission)==null?void 0:z.name)||"Manual"),1)]),e("div",null,[t[10]||(t[10]=e("strong",null,"Location:",-1)),m(" "+o(i.vehicle.location_name),1)])])])]),e("div",null,[O.value?(r(),n("div",de,[e("div",ae,[t[13]||(t[13]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",ue,[t[12]||(t[12]=e("h3",{class:"text-sm font-medium"}," Booking Error ",-1)),e("div",ce,[e("ul",me,[i.errors.booking_conflict?(r(),n("li",ve,o(i.errors.booking_conflict),1)):a("",!0),i.errors.vehicle_unavailable?(r(),n("li",ge,o(i.errors.vehicle_unavailable),1)):a("",!0),i.errors.rate_limit?(r(),n("li",be,o(i.errors.rate_limit),1)):a("",!0),i.errors.user_booking_conflict?(r(),n("li",fe,o(i.errors.user_booking_conflict),1)):a("",!0)])])])])])):a("",!0),f.value?(r(),n("div",ye,[e("div",xe,[t[19]||(t[19]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-yellow-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),e("div",pe,[t[18]||(t[18]=e("h3",{class:"text-sm font-medium"}," Active Booking Found ",-1)),e("div",ke,[t[17]||(t[17]=e("p",{class:"mb-2"},"You already have active bookings for this vehicle:",-1)),e("ul",he,[(r(!0),n(h,null,_(i.userActiveBookings,s=>{var v,L;return r(),n("li",{key:s.id},o(new Date(s.pickup_datetime).toLocaleString())+" ("+o((v=s.pricing_tier)==null?void 0:v.duration_from)+" "+o((L=s.pricing_tier)==null?void 0:L.duration_unit)+") - Status: "+o(s.status),1)}),128))]),e("p",_e,[t[15]||(t[15]=m(" Please ")),Y(d(I),{href:c.route("bookings.index"),class:"text-blue-600 hover:text-blue-800 underline"},{default:N(()=>t[14]||(t[14]=[m("manage your existing bookings")])),_:1,__:[14]},8,["href"]),t[16]||(t[16]=m(" or wait until they are completed before booking again. "))])])])])])):a("",!0),e("form",{onSubmit:J(G,["prevent"]),class:"space-y-6"},[e("fieldset",{disabled:f.value,class:p(["space-y-6",{"opacity-60":f.value}])},[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Select Rental Duration",-1)),e("div",Be,[(r(!0),n(h,null,_(i.vehicle.pricing_tiers,s=>(r(),n("div",{key:s.id,class:p(["border rounded-lg p-4 cursor-pointer transition-all",d(l).pricing_tier_id==s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"]),onClick:v=>d(l).pricing_tier_id=s.id},[e("div",Me,[e("div",Se,[x(e("input",{type:"radio",id:`tier-${s.id}`,value:s.id,"onUpdate:modelValue":t[0]||(t[0]=v=>d(l).pricing_tier_id=v),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,Ve),[[F,d(l).pricing_tier_id]]),e("div",Te,[e("label",{for:`tier-${s.id}`,class:"text-sm font-medium text-gray-700 cursor-pointer"},o(s.duration_from)+" "+o(s.duration_unit),9,Pe)])]),e("div",Ae," â‚±"+o(s.price),1)])],10,Ce))),128))]),i.errors.pricing_tier_id?(r(),n("div",De,o(i.errors.pricing_tier_id),1)):a("",!0)]),e("div",$e,[e("div",null,[t[21]||(t[21]=e("label",{for:"pickup_date",class:"block text-sm font-medium text-gray-700"},"Pickup Date",-1)),x(e("input",{type:"date",id:"pickup_date","onUpdate:modelValue":t[1]||(t[1]=s=>d(l).pickup_date=s),min:d(k),onChange:R,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:""},null,40,je),[[w,d(l).pickup_date]]),i.errors.pickup_date?(r(),n("div",ze,o(i.errors.pickup_date),1)):a("",!0)]),e("div",null,[t[22]||(t[22]=e("label",{for:"pickup_time",class:"block text-sm font-medium text-gray-700"},"Pickup Time",-1)),x(e("input",{type:"time",id:"pickup_time","onUpdate:modelValue":t[2]||(t[2]=s=>d(l).pickup_time=s),min:b.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:""},null,8,Le),[[w,d(l).pickup_time]]),i.errors.pickup_time?(r(),n("div",Ee,o(i.errors.pickup_time),1)):a("",!0)])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Payment Method",-1)),e("div",Ne,[(r(!0),n(h,null,_(i.availablePaymentMethods,s=>(r(),n("div",{key:s.id,class:p(["border rounded-lg p-4 cursor-pointer transition-all",d(l).payment_mode_id==s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"]),onClick:v=>d(l).payment_mode_id=s.id},[e("div",Ue,[x(e("input",{type:"radio",id:`mode-${s.id}`,value:s.id,"onUpdate:modelValue":t[3]||(t[3]=v=>d(l).payment_mode_id=v),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,Oe),[[F,d(l).payment_mode_id]]),e("div",Re,[e("label",{for:`mode-${s.id}`,class:"text-sm font-medium text-gray-700 cursor-pointer"},o(s.name),9,Ge),s.type==="cod"?(r(),n("p",Qe," Pay when you pick up the vehicle ")):s.type==="gcash"?(r(),n("p",qe," Pay via GCash using owner's QR code ")):a("",!0)])])],10,Fe))),128)),!i.availablePaymentMethods||i.availablePaymentMethods.length===0?(r(),n("div",He,t[23]||(t[23]=[e("p",{class:"font-medium"}," No payment methods available ",-1),e("p",{class:"text-sm"}," The owner needs to configure their payment settings. ",-1)]))):a("",!0)]),i.errors.payment_mode_id?(r(),n("div",Ye,o(i.errors.payment_mode_id),1)):a("",!0)]),U.value?(r(),n("div",Ie,[t[25]||(t[25]=e("label",{for:"reference_number",class:"block text-sm font-medium text-gray-700"},"GCash Reference Number (Optional)",-1)),x(e("input",{type:"text",id:"reference_number","onUpdate:modelValue":t[4]||(t[4]=s=>d(l).reference_number=s),placeholder:"Enter reference number if available",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,512),[[w,d(l).reference_number]]),i.errors.reference_number?(r(),n("div",Je,o(i.errors.reference_number),1)):a("",!0)])):a("",!0),C.value?(r(),n("div",Ke,[e("div",We,[t[26]||(t[26]=e("span",{class:"text-lg font-semibold text-gray-800"},"Total Amount:",-1)),e("span",Xe,"â‚±"+o(C.value.price),1)])])):a("",!0),e("button",{type:"submit",disabled:!M.value||!d(l).pricing_tier_id||!d(l).payment_mode_id,class:p(["w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white disabled:opacity-50 disabled:cursor-not-allowed",M.value?"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500":"bg-gray-400"])},[g.value?(r(),n("svg",et,t[27]||(t[27]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):a("",!0),m(" "+o(f.value?"Booking Disabled - Active Booking Exists":g.value?"Creating Booking...":"Create Booking"),1)],10,Ze)],10,we)],32)])])])])])])]}),_:1}))}};export{nt as default};
